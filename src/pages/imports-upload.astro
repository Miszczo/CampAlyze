---
import Layout from "../layouts/Layout.astro";
import ImportForm from "../components/ImportForm";
import { ToastProvider, Toaster } from "../components/hooks/useToast";
import { supabaseServerClient } from "../db/supabase.server";

// Ochrona przed dostępem niezalogowanych użytkowników
const supabase = supabaseServerClient(Astro);
const { data: { session } } = await supabase.auth.getSession();

if (!session) {
  return Astro.redirect("/login");
}
---

<Layout title="Importuj plik danych">
  <div class="container mx-auto px-4 py-8">
    <div class="mb-6">
      <h1 class="text-2xl font-bold">Importuj dane</h1>
      <p class="text-slate-500 mt-1">
        Zaimportuj dane z pliku CSV lub XLSX do analizy
      </p>
    </div>
    
    <div class="flex justify-between items-center mb-6">
      <a 
        href="/imports" 
        class="text-primary hover:underline flex items-center"
      >
        ← Powrót do listy importów
      </a>
    </div>
    
    <ToastProvider client:load>
      <ImportForm 
        client:load
        onImportSuccess={(data) => {
          window.location.href = `/imports/${data.id}`;
        }}
      />
      <Toaster client:load />
    </ToastProvider>
    
    <div class="mt-8 bg-slate-50 rounded-lg p-6 border border-slate-200 dark:bg-slate-800 dark:border-slate-700">
      <h2 class="text-lg font-medium mb-4">Wskazówki dotyczące importu plików</h2>
      <ul class="space-y-2 list-disc list-inside text-slate-700 dark:text-slate-300">
        <li>Upewnij się, że plik jest w formacie CSV lub XLSX</li>
        <li>Maksymalny rozmiar pliku to 10MB</li>
        <li>Dane powinny zawierać następujące kolumny:
          <ul class="pl-6 mt-1 space-y-1 list-disc">
            <li>Data</li>
            <li>Nazwa kampanii</li>
            <li>Wyświetlenia</li>
            <li>Kliknięcia</li>
            <li>Wydatki</li>
          </ul>
        </li>
        <li>Po imporcie możesz przejrzeć i analizować wyniki w sekcji Kampanie</li>
      </ul>
    </div>
  </div>
</Layout>
